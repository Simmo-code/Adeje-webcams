<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Adeje & Nearby Webcams Map</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b7285">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ“¹</text></svg>">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<style>
  :root {
    --bg: #ffffff;
    --fg: #0b0b0b;
    --card: rgba(255,255,255,0.96);
    --border: #e6e6e6;
  }
  .dark {
    --bg: #0e1116;
    --fg: #f1f5f9;
    --card: rgba(20,24,31,0.9);
    --border: #253042;
  }
  html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  #map { height: 100%; width: 100%; }
  .panel {
    position: absolute; top: 10px; left: 10px; z-index: 1000;
    background: var(--card); padding: 12px 14px; border-radius: 14px;
    max-width: 340px; box-shadow: 0 6px 18px rgba(0,0,0,0.15); border: 1px solid var(--border);
  }
  .row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; flex-wrap: wrap; }
  .panel input[type="text"] { flex: 1; min-width: 140px; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--fg); }
  .tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; }
  .tag { font-size: 12px; background: transparent; border: 1px solid var(--border); border-radius: 999px; padding: 4px 10px; cursor: pointer; }
  .tag input { margin-right: 6px; vertical-align: middle; }
  .panel ul { list-style: none; padding: 0; margin: 8px 0 0; max-height: 260px; overflow: auto; }
  .panel li { padding: 6px 0; border-bottom: 1px solid var(--border); }
  .panel a { text-decoration: none; font-weight: 600; color: var(--fg); }
  .controls { display: flex; gap: 8px; align-items: center; }
  .btn { border: 1px solid var(--border); padding: 6px 10px; border-radius: 10px; background: transparent; color: var(--fg); cursor: pointer; }
  .thumb { width: 260px; height: 146px; object-fit: cover; border-radius: 10px; border: 1px solid var(--border); display:block; }
  .muted { opacity: 0.7; font-size: 12px; }
</style>
</head>
<body>
<div id="map"></div>

<div class="panel" id="panel">
  <div class="row controls">
    <input id="q" placeholder="Search webcams..." oninput="filterList(this.value)" />
    <button class="btn" id="darkBtn" title="Toggle dark mode">ðŸŒ™</button>
    <button class="btn" id="installBtn" title="Install app">âž•ðŸ“²</button>
  </div>
  <div class="tags" id="tags"></div>
  <ul id="list"></ul>
  <div class="muted">Tip: click a name to fly to the marker.</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>
  const WEBCAMS = [{"name": "Playa del Duque (Skyline)", "lat": 28.0914, "lon": -16.7439, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-del-duque.html", "area": "Adeje", "thumb": null}, {"name": "Playa del Duque â€“ El Beril (Skyline)", "lat": 28.0935, "lon": -16.7505, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-del-duque-el-beril.html", "area": "Adeje", "thumb": null}, {"name": "Playa de FaÃ±abÃ© (Skyline)", "lat": 28.08495, "lon": -16.73697, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-de-fanabe.html", "area": "Adeje", "thumb": null}, {"name": "Playa de Torviscas (Index)", "lat": 28.08231, "lon": -16.73616, "url": "https://worldcam.eu/webcams/africa/canary-islands/32119-tenerife-costa-adeje-playa-de-torviscas", "area": "Adeje", "thumb": null}, {"name": "Playa La Pinta (Skyline)", "lat": 28.0798185, "lon": -16.7353506, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-la-pinta.html", "area": "Adeje", "thumb": null}, {"name": "Puerto ColÃ³n Marina (Skyline)", "lat": 28.07826, "lon": -16.73685, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/puerto-colon-tenerife.html", "area": "Adeje", "thumb": null}, {"name": "Playa de Troya (Skyline)", "lat": 28.058056, "lon": -16.735556, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-troya.html", "area": "Las AmÃ©ricas", "thumb": null}, {"name": "Playa del Bobo (Skyline)", "lat": 28.0796, "lon": -16.7336, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-del-bobo.html", "area": "Adeje", "thumb": null}, {"name": "El Duque Norte (Costa Adeje)", "lat": 28.095, "lon": -16.7467, "url": "https://costa-adeje.es/en/webcams/el-duque-norte", "area": "Adeje", "thumb": null}, {"name": "La Caleta - Playa La Enramada (Skyline)", "lat": 28.09834722222222, "lon": -16.752194444444445, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/la-caleta-costa-adeje.html", "area": "La Caleta", "thumb": null}, {"name": "Playa ParaÃ­so â€“ Las Galgas (WhatsUpCams)", "lat": 28.1185, "lon": -16.7779, "url": "https://www.whatsupcams.com/en/webcams/spain/canary-islands/tenerife/live-webcam-playa-de-las-galgas-playa-paraiso-la-gomera-island-adeje-tenerife/", "area": "Playa ParaÃ­so", "thumb": null}, {"name": "Callao Salvaje (index)", "lat": 28.1232, "lon": -16.7894, "url": "https://www.webcamgalore.com/EN/webcam/Spain/Callao-Salvaje/34998.html", "area": "Callao Salvaje", "thumb": null}, {"name": "Abama / Playa Abama (index)", "lat": 28.1738, "lon": -16.8159, "url": "https://www.webcamgalore.com/EN/webcam/Spain/Guia-de-Isora/", "area": "GuÃ­a de Isora", "thumb": null}, {"name": "Playa de Las Vistas â€“ Los Cristianos (Skyline)", "lat": 28.05260611111111, "lon": -16.72478333333333, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-las-vistas.html", "area": "Los Cristianos", "thumb": null}, {"name": "Playa de Los Cristianos (Skyline)", "lat": 28.0557, "lon": -16.7205, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-los-cristianos.html", "area": "Los Cristianos", "thumb": null}, {"name": "BahÃ­a de Los Cristianos â€“ Costamar (Skyline)", "lat": 28.049, "lon": -16.7169, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/bahia-los-cristianos.html", "area": "Los Cristianos", "thumb": null}, {"name": "Puerto de Santiago â€“ Playa La Arena area (Skyline)", "lat": 28.222, "lon": -16.844, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/santiago-del-teide-puerto-de-santiago.html", "area": "Puerto de Santiago", "thumb": null}, {"name": "Los Gigantes Cliffs & Marina (Skyline)", "lat": 28.243, "lon": -16.853, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/los-gigantes.html", "area": "Los Gigantes", "thumb": null}, {"name": "El MÃ©dano Beach (Skyline)", "lat": 28.0458, "lon": -16.536, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/playa-de-el-medano.html", "area": "El MÃ©dano", "thumb": null}, {"name": "El MÃ©dano â€“ Surf & Kitesurf (Skyline)", "lat": 28.0469, "lon": -16.533, "url": "https://www.skylinewebcams.com/en/webcam/espana/canarias/santa-cruz-de-tenerife/surf-kitesurf-medano.html", "area": "El MÃ©dano", "thumb": null}];
  const AREAS = [...new Set(WEBCAMS.map(w => w.area))].sort();

  const map = L.map('map', { zoomControl: true });
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  const markers = L.markerClusterGroup({ chunkedLoading: true, chunkProgress: null });
  const markerIndex = new Map();

  function addMarkers() {
    WEBCAMS.forEach(w => {
      const m = L.marker([w.lat, w.lon]);
      const thumb = w.thumb ? `<img class="thumb" src="${w.thumb}" loading="lazy" alt="thumbnail" onerror="this.style.display='none'">` : '';
      const html = `
        <div>
          <strong>${w.name}</strong><br>
          ${thumb}
          <a href="${w.url}" target="_blank" rel="noopener">Open live webcam</a><br>
          <span class="muted">${w.area}</span>
        </div>`;
      m.bindPopup(html);
      markers.addLayer(m);
      markerIndex.set(w.name, m);
    });
    map.addLayer(markers);
    const bounds = L.latLngBounds(WEBCAMS.map(w => [w.lat, w.lon]));
    map.fitBounds(bounds, { padding: [20, 20] });
  }
  addMarkers();

  const listEl = document.getElementById('list');
  const tagsEl = document.getElementById('tags');
  const state = { q: '', areas: new Set(AREAS) };

  function renderTags() {
    tagsEl.innerHTML = '';
    AREAS.forEach(a => {
      const id = 'area-' + a.replace(/\s+/g,'-');
      const label = document.createElement('label');
      label.className = 'tag';
      label.innerHTML = `<input type="checkbox" id="${id}" checked> ${a}`;
      tagsEl.appendChild(label);
      document.getElementById(id).addEventListener('change', e => {
        if (e.target.checked) state.areas.add(a); else state.areas.delete(a);
        renderList();
        filterMarkers();
      });
    });
  }

  function renderList() {
    const q = state.q.toLowerCase();
    listEl.innerHTML = WEBCAMS
      .filter(w => state.areas.has(w.area))
      .filter(w => !q || w.name.toLowerCase().includes(q) || w.area.toLowerCase().includes(q))
      .map(w => `<li><a href="#" onclick="flyTo(${w.lat}, ${w.lon}); return false;">${w.name}</a> <span class="muted">(${w.area})</span></li>`)
      .join('');
  }

  function filterMarkers() {
    const q = state.q.toLowerCase();
    markers.clearLayers();
    WEBCAMS.forEach(w => {
      if (!state.areas.has(w.area)) return;
      if (q && !(w.name.toLowerCase().includes(q) || w.area.toLowerCase().includes(q))) return;
      const m = markerIndex.get(w.name);
      if (m) markers.addLayer(m);
    });
  }

  function filterList(q) {
    state.q = q;
    renderList();
    filterMarkers();
  }

  window.flyTo = function(lat, lon) {
    map.flyTo([lat, lon], 16, { duration: 0.8 });
    setTimeout(() => {
      markers.eachLayer(layer => {
        const ll = layer.getLatLng();
        if (Math.abs(ll.lat - lat) < 1e-6 && Math.abs(ll.lng - lon) < 1e-6) {
          layer.openPopup();
        }
      });
    }, 900);
  }

  renderTags();
  renderList();

  const darkBtn = document.getElementById('darkBtn');
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  if (prefersDark) document.documentElement.classList.add('dark');
  darkBtn.onclick = () => document.documentElement.classList.toggle('dark');

  let deferredPrompt;
  const installBtn = document.getElementById('installBtn');
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.opacity = 1;
  });
  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
  });

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(console.warn);
  }

  setInterval(() => {
    document.querySelectorAll('.thumb').forEach(img => {
      const url = new URL(img.src);
      url.searchParams.set('_t', Date.now());
      img.src = url.toString();
    });
  }, 60000);
</script>
</body>
</html>